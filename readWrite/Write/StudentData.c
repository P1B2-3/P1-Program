/*
This function is created by: Asger Geel Weirs√∏e for use only in the P1-Project.
The function creates a document that writes the data used to generate a school schedule.


Date:           7/12
Version:        2.00
*/

void Write_File_For_Students(Class_t classdata[], int numberOfClasses, FILE *fptr);

int StudentData(Class_t classdata[], int numberOfClasses){
    
    FILE *fptr; /* filpointer */
    char yes_or_no;
    #if defined(_WIN32)     /* den tjekker om det er windows til at lave en folder */
        _mkdir("./data");
    #else                   /* laver en en text fil i linux */
        mkdir("./data", 0700); 
    #endif     

    
    while(1) {
        if ((fptr=fopen("data/StudentData.txt","r"))==NULL){    /*  */

        Write_File_For_Students(classdata,numberOfClasses,fptr);

        } else {

            printf("File already exists, do you want to override it? [Y]es / [N]o\n");
            scanf("%c",&yes_or_no);

            if(yes_or_no == 'N') {

                printf("File not overridden\n");
                break;
            }else if(yes_or_no == 'Y') {

                printf("Deleting file.\n");
                Write_File_For_Students(classdata,numberOfClasses,fptr);
                printf("New file created.\n");
                break;
            }else {

                printf("ERROR: indput incorrect.\n");
            
            }
        } 
    }
          
    
    fclose(fptr);

    return (0);
}

void Write_File_For_Students(Class_t classdata[], int numberOfClasses, FILE *fptr) {
    int i,j,k;
    printf("Did not find file, creating new\n");
        fptr = fopen("data/StudentData.txt", "w"); 
        fputs("//This entire document is dedicated to the processing of a school schedule.\n",fptr);
        fputs("//Please do not edit this file for any reasons. Unless you know what you are doing.\n\n",fptr);

        fputs("-------------ALL STUDENTS--------------\n",fptr);
        
        for(i = 0;i<numberOfClasses;i++){
            fputs("--Class start--\n",fptr);
            fputs("##",fptr);
            fprintf(fptr, "Number in class: %i \n", classdata[i].student_num );
            fprintf(fptr,"Klasse nr: %i.%c\n",classdata[i].year,classdata[i].name );
            fprintf(fptr,"Nr of examener: %i ",(int)strlen(classdata[i].subjects[j].subject));
            fputs("&",fptr);
            for(j = 0; j<strlen(classdata[i].subjects[j].subject);j++) {
                fprintf(fptr, "%i: %s\n",j+1,classdata[i].subjects[j].subject );
            }
            fputs("&",fptr);

            for(k = 1; k < classdata[i].student_num ;k++) {
                fputs("--Student Start--",fptr);
                fprintf(fptr,"Student unikID:: %i\n",classdata[i].students[k].unikID);
                fprintf(fptr,"Nr in class: %i\n",classdata[i].students[k].exam_number );
                fprintf(fptr,"First name: %s\n",classdata[i].students[k].name);
                fprintf(fptr, "Last name: %s\n",classdata[i].students[k].surname);
                fputs("--Student End--",fptr);
            }

            fputs("--Class end--\n\n",fptr);
        }
}

